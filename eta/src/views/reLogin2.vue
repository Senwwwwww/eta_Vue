<template>
  <div>
    <fish/>
    <el-form ref="registerForm" :model="form" :rules="rules" label-width="80px" class="register-box">
      <div id="image_wo3">
        <el-steps :space="200" :active="2" finish-status="success" process-status="process">
          <el-step title="步骤 1"></el-step>
          <el-step title="步骤 2"></el-step>
          <el-step title="进行中"></el-step>
        </el-steps>
      </div>
      <!-- 插入一张logo图片 -->
      <div id="image_wo">
        <img src="../assets/logo.png" alt="" class="logo"/>
      </div>
      <div id = "image_wo2">
        <h3 class="register-title" id="image_lo2">重置密码</h3>
      </div>
      <el-form-item label="密码" prop="password">
        <el-input type="password" placeholder="请输入密码" v-model="form.password"/>
      </el-form-item>

      <el-form-item label="确认密码" prop="checkPass">
        <el-input type="password" placeholder="请确认密码" v-model="form.checkPass"/>
      </el-form-item>

      <el-form-item>
        <div class="button-container">
          <el-button type="primary" @click="onSubmit('registerForm')" >完成</el-button>
          <el-button @click="redirectTorelo1" >上一步</el-button>
        </div>
      </el-form-item>
    </el-form>

<!--    <el-dialog-->
<!--        title="温馨提示"-->
<!--        :visible.sync="dialogVisible"-->
<!--        width="30%">-->
<!--      <span>{{ dialogMessage }}</span>-->
<!--      <span slot="footer" class="dialog-footer">-->
<!--        <el-button type="primary" @click="closeDialog">确定</el-button>-->
<!--      </span>-->
<!--    </el-dialog>-->
  </div>
</template>

<script>
import Fish from "@/components/Fish.vue";
import {strTomd5} from "@/util/md5";
import {instance} from "@/util/request";

export default {
  name: "register_vue",
  components: {Fish},
  data() {
    const validatePass = (rule, value, callback) => {
      if (value === '') {
        callback(new Error('请输入密码'));
      } else {
        if (this.form.checkPass !== '') {
          this.$refs.registerForm.validateField('checkPass');
        }
        callback();
      }
    };
    const validatePass2 = (rule, value, callback) => {
      if (value === '') {
        callback(new Error('请再次输入密码'));
      } else if (value !== this.form.password) {
        callback(new Error('两次输入密码不一致!'));
      } else {
        callback();
      }
    };

    return {
      form: {

        password: '',
        checkPass: '',
        Md5password: '',
      },
      rules: {

        password: [
          {required: true, validator: validatePass, trigger: 'blur'}
        ],
        checkPass: [
          {required: true, validator: validatePass2, trigger: 'blur'}
        ]
      },
      // dialogMessage: ''
    }
  },
  methods: {
    validate(callback) {
      this.$refs.registerForm.validate((valid, fields) => {
        callback(valid, fields);
      });
    },
    resetFields() {
      this.$refs.registerForm.resetFields();
    },
    onSubmit(formName) {
      this.validate((valid, fields) => {
        if (valid) {
          this.form.Md5password = strTomd5(this.form.password);
          // 数据库同步
          instance.put('/user/update/'+sessionStorage.getItem("userID")+'?'+'userId='+this.form.userId+'&&'+'password='+this.form.Md5password,this.form).then(response => {
            window.location.href ='/reLoginok'
          })
              .catch(error => {
                this.$message.error("修改失败，请稍后再试")
              })
          //跳转
        } else {
          this.$message.error( "请输出正确的密码");


        }
      });
    },
    onReset(formName) {
      this.resetFields();
    },
    closeDialog() {
      this.dialogVisible = false;
    },
    redirectTorelo1() {
      window.location.href ='/relogin';
    }
  }
}
</script>

<style lang="scss" scoped>
.register-box {
  border: 1px solid #DCDFE6;
  width: 360px;
  margin: 100px auto;
  padding: 40px 30px;
  padding-left: 0px;
  border-radius: 8px;
  box-shadow: 0 0 20px #ddd;
}

.logo {
  display: block;
  width: 100px;
  margin: 0 auto 20px auto;
}

.register-title {
  text-align: center;
  margin: 20px 0;
  color: #303133;
  font-weight: bold;
  font-size: 20px;
}

.button-container {
  display: flex;
  justify-content: space-between;
}
#image_wo{
  padding-left: 20px;
  padding-bottom: 0px;
  padding-right: 0px;
  padding-right: 0px;
}
#image_wo2{
  padding-left: 20px;
  padding-bottom: 0px;
  padding-right: 0px;
  padding-right: 0px;
}
#image_wo3{
  padding-left: 87px;
  padding-bottom: 0px;
  padding-right: 0px;
  padding-right: 0px;
  opacity: 0.5;
}
</style>
